version: '3.8'

services:
  devcontainer:
    build:
      context: ..
      dockerfile: .devcontainer/Dockerfile
      args:
        TZ: ${TZ:-America/Los_Angeles}
        CLAUDE_CODE_VERSION: latest
        GIT_DELTA_VERSION: 0.18.2
        ZSH_IN_DOCKER_VERSION: 1.2.0
    command: sleep infinity
    cap_add:
      - NET_ADMIN
      - NET_RAW
    runtime: nvidia
    shm_size: 4g
    volumes:
      - ..:/workspace:delegated
      - claude-code-bashhistory:/commandhistory
      - claude-code-config:/home/node/.claude
      - ${FSLDIR}:${FSLDIR}:ro
    environment:
      NODE_OPTIONS: "--max-old-space-size=4096"
      CLAUDE_CONFIG_DIR: "/home/node/.claude"
      POWERLEVEL9K_DISABLE_GITSTATUS: "true"
      PYTHONPATH: "/workspace:/workspace/submodules/epi1"
      FSLDIR: "${FSLDIR}"
      FSLOUTPUTTYPE: "NIFTI_GZ"
      PATH: "/opt/conda/bin:/usr/local/share/npm-global/bin:${FSLDIR}/bin:/usr/local/bin:/usr/bin:/bin"
      NVIDIA_VISIBLE_DEVICES: "all"
    user: node

volumes:
  claude-code-bashhistory:
  claude-code-config:
